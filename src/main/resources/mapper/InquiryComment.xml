<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bunge.inquiry.mapper.InquiryCommentMapper">

    <select id="findCommentsByInquiryId" resultType="InquiryComment">
        SELECT * FROM inquiry_comment WHERE inquiryId = #{inquiryId} ORDER BY createdAt ASC
    </select>

    <select id="findRepliesByCommentId" resultType="InquiryComment">
        SELECT * FROM inquiry_comment WHERE parentCommentId = #{parentCommentId}
    </select>

    <insert id="insertComment" parameterType="InquiryComment">
        INSERT INTO inquiry_comment (inquiryId, memberId, parentCommentId, content, createdAt, updatedAt, isNotified)
        VALUES (#{inquiryId}, #{memberId}, #{parentCommentId}, #{content}, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, #{isNotified})
    </insert>

    <delete id="deleteComment">
        DELETE FROM inquiry_comment WHERE commentId = #{commentId}
    </delete>

    <update id="updateComment">
        UPDATE inquiry_comment
        SET content = #{content}, updatedAt = CURRENT_TIMESTAMP, isNotified = #{isNotified}
        WHERE commentId = #{commentId}
    </update>

</mapper>
